# 케이블의 앞은 LAN 기기였다

## 허브와 스위치, 라우터의 탐험

케이블에 송출한 패킷이 리피터 허브, 스위칭 허브, 라우터 등 네트워크 기기를 경유하여 인터넷을 향해 진행하는 부분 학습

- 케이블과 리피터, 허브 속을 신호가 흘러간다
- 스위칭 허브의 패킷 중계 동작
- 라우터의 패킷 중계 동작
- 라우터의 부가 기능

# [STORY 01] 케이블과 리피터, 허브 속을 신호가 흘러간다

## 하나하나의 패킷이 독립된 것으로 동작한다

컴퓨터에서 송신된 패킷은 허브나 라우터라는 중계 장치에 의해 목적지를 향해 진행된다.

중계 장치는 데이터 부분을 보지 않고 패킷을 중계한다

내용을 보지 않기 때문에 애플리케이션의 데이터나 TCP 프로토콜의 제어 정보의 내용이 패킷을 운반하는 동작에 영향을 주지 않는다

## LAN 케이블은 신호를 약화시키지 않는 것이 핵심이다

LAN 어댑터에서 패킷이 송신되어 케이블로 나가는 부분부터 시작한다

- LAN 어댑터의 PHY(MAU) 회로에서 전기 신호를 형태로 바꾼 패킷은 RJ-45 커넥터를 통해 트위스트 페어 케이블(꼰 선쌍)에 들어간다

> PHY(MAU)?
Physical Layer Device - 현재의 100 메가비트/초 이상의 이더넷
Medium Attachment Unit - 이전의 저속 방식
> 
- 이더넷 신호는 플러스와 마이너스의 전압이다
- LAN 어댑터의 회로는 RJ-45에 직접 결선되어 있다
- 신호는 케이블을 타고 리피터 허브의 커넥터 부분에 도착한다
- 신호는 갈수록 약해지는데 이게 잘못 판독되어 통신 오류의 원인이 된다

## ‘꼼’은 잡음을 방지하기 위한 방법이다

LAN 케이블로 사용하는 트위스트 페어 케이블에는 이런 잡음의 영향을 억제하는 대책이 마련되어 있다. → ‘꼼’

신호선을 마주 꼬아서 잡음을 막을 수 있다

- 잡음의 원인은 케이블 주위에서 발생하는 전자파
- 신호와 잡음의 전류가 뒤섞여서 신호의 파형이 변형되는데 이것이 잡음의 정체
- 기기에서 누설되는 전자파는 케이블 밖에서 오는 것으로 선을 꼼으로써 막을 수 있다
    - 전류가 나선형이 되어 전류가 흐르는 방향이 반대가 됨 → 전류 상쇄
- 케이블 안의 인접한 신호선에서 누설되는 전자파. 다른 신호선에 대한 잡음이 되는데 이런 잡음에 의한 영향을 `크로스 토크`라고 한다
    - 거리가 가까운 곳이 문제
- 신호선을 마주 꼬면 잡음의 영향이 줄면서 케이블 성능이 향상되지만 성능 향상의 대책은 더 있음
- 피복을 입히면 됨
- 트위스트 페어 케이블은 카테고리라는 척도로 성능을 나타냄

## 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다

전체에 패킷의 신호를 뿌리고 수신처 MAC 주소에 해당하는 기기만 패킷만 수신한다는 원리를 실현한 것이 리피터 허브 → 이더넷의 기본에 따라 신호를 뿌림

- 리피터 허브 내부에서 PHY 회로와 커넥터 사이의 신호선을 교차시켜서 접속함
- 리피터 허브에서 끝의 커넥터에는 MDI/MDI-X(Media Dependent Interface/MDI-Crossover)라는 전환 스위치가 붙어 있다
    - MDI : RJ-45 커넥터와 신호 송,수신 회로를 직접 결선한 것
    - MDI-X : 교차하여 결선하는 것을 나타냄
- 허브의 커넥터 부분은 MDI-X, 허브끼리 접속할 때는 한 쪽을 MDI로 설정해야 한다

> 리피터 허브는 연결된 케이블 전부에 신호를 송신한다
> 
- 변형되고 데이터가 변화 한것 같은 신호도 그대로 흘려버림
    - 이 경우 디지털 데이터로 변환되고 나서 FCS를 검사하는 곳에서 변화된 패킷은 폐기됨
    - 폐기해도 데이터가 없어 지는 것은 아니다
    - 프로토콜 스택의 TCP 담당 부분이 수신 확인 응답을 못받았으면 패킷을 다시 보낸다

# [STORY 02] 스위칭 허브의 패킷 중계 동작

## 스위칭 허브는 주소 테이블로 중계한다

스위칭 허브는 이더넷의 패킷을 그대로 목적지를 향해 중계하도록 만들어져 있다

스위칭 허브의 동작 추적

스위칭 허브의 포트는 수신처 MAC 주소를 검사하지 않고 모든 패킷을 수신하여 버퍼 메모리에 저장하기 때문에 LAN 어댑터와 달리 MAC 주소가 할당되어 있지 않다

> 스위칭 허브는 MAC 주소표에서 MAC 주소를 조사하고 해당하는 포트에서 신호를 송신한다
> 

## MAC 주소 테이블을 등록 및 갱신한다

- 패킷을 수신했을 때 송신처 MAC 주소를 조사하고 이것을 수신한 입력 포트 번호와 하나의 세트로 MAC 주소표에 등록
- MAC 주소표에 등록한 정보는 일정 시간이 경과하면 삭제한다
- MAC 주소표의 내용은 스위칭 허브 자체가 스스로 등록하거나 삭제하므로 수동으로 등록 및 삭제할 필요가 없다

## 예외적인 동작

- 스위칭 허브에 리피터 허브가 접속되어 있는 경우 발생
- MAC 주소표에 수신처 MAC 주소와 일치하는 주소가 등록되어 있지 않은 경우

LAN에는 1초에 수천 개 이상의 패킷을 흘려보내는 능력이 있어서 큰 문제가 되지 않는다. 수신처 MAC 주소가 브로드캐스트 주소인 경우에도 수신 포트를 제외하고 모든 포트애서 패킷을 송신함

## 전이중 모드에서 송신과 수신을 동시에 실행한다

송신과 수신을 동시에 실행할 수 있는 성질도 리피터 허브에는 없는 스위칭 허브의 특징이다

리피터 허브를 사용하면 신호가 뒤섞여 파괴되는 충돌 현상(이더넷의 성질)이 일어나지 않는다?????

그니까 충돌은 이더넷의 성질이지만 리피터 허브를 사용함으로써 이런 문제를 막을 수 있다라는 소리인듯

⇒ 리피터 허브가 아니라 스위칭 허브를 설명하는 것 같다. 내가 보기엔 번역의 문제거나 내 이해의 문제 둘 중 하나일 텐데 리피터 허브는 전이중 모드를 가지고 있지 않다고 공부했다. 전이중 모드는 스위칭 허브의 특성이고 리피터 허브는 반이중 모드이다.

## 최적의 전송 속도로 보내는 자동 조정

접속한 상대가 전이중 모드를 지원하는지 검출하고 동작 모드를 자동으로 전환하는 기능

상대의 전송속도도 검출하여 전송 속도도 자동으로 전환하는데, 이 기능을 자동 조정(auto negotiation)이라고 한다

이더넷은 데이터가 흐르고 있지 않을 때는 `링크 펄스`라는 펄스형의 신호를 흘린다

## 스위칭 허브는 복수의 중계 동작을 동시에 실행한다

스위칭 허브는 수신처 MAC 주소의 기기가 존재하는 포트 이외에는 송신 동작을 실행하지 않으므로 다른 포트는 빈 상태가 된다

리피터 허브 쪽은 들어온 신호를 모든 포트에서 뿌리므로 동시에 두 개 이상의 신호가 들어오면 패킷이 충돌하기 때문에 복수의 신호를 동시에 흘릴 수 없다

기기 전체에서 중계할 수 있는 패킷의 수는 스위칭 허브 쪽이 많다