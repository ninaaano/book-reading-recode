OSI 모델의 2계층인 데이터 링크 계층에 대해 설명한다

**목표**

- 이더넷 이해
- CSMA/CD 방식 이해
- MAC 주소 이해
- 스위치 이해
- 충돌 도메인 이해
- 이더넷 표준 이해

## LESSON 12 데이터 링크 계층의 역할과 이더넷

### 이더넷?

랜에서 데이터를 주고 받으려면 데이터 링크 계층의 기술이 필요하다

데이터 링크 계층은 네트워크 장비 간 신호를 주고 받는 규칙을 정하는 계층으로, 랜에서 데이터를 정상적으로 주고받기 위해 필요한 계층이다. 그 규칙들 중 일반적으로 가장 많이 사용되는 규칙이 이더넷이다.

- 이더넷은 랜에서 적용되는 규칙이다.
    - 이더넷은 허브와 같은 장비에 연결된 컴퓨터와 데이터를 주고받을 때 사용한다
- 허브는 약해지거나 파형이 뭉개진 전기 신호를 복원시키고 해당 전기 신호를 전달받은 포트를 제외한 나머지 포트에 전달한다

- 데이터에 목적지 정보를 추가해서 보내고 목적지 이외의 컴퓨터는 데이터를 받더라도 무시하게 되어 있다
- 컴퓨터가 여러 대가 동시에 데이터를 보내면 데이터들이 서로 부딪힐 수 있는데, 이것을 충돌이라고 한다
- 이더넷은 여러 컴퓨터가 동시에 데이터를 전송해도 충돌이 일어나지 않는 구조로 되어 있다
- 데이터가 동시에 케이블을 지나가면 충돌할 수밖에 없는데, 그래서 데이터를 보내는 시점을 늦춘다 → CSMA/CD

> CSMA/CD?
Carrier Sense Multiple Access with Collision Detection(반송과 감지 다중 접속 및 충돌 탐지)
> 

`CS`는 데이터는 보내려고 하는 컴퓨터가 케이블에 신호가 흐르고 있는지 확인한다는 규칙이다

`MA`는 케이블에 데이터가 흐르고 있지 않다면 데이터를 보내도 좋다는 규칙이다

`CD`는 충돌이 발생하고 있는지를 확인하는 규칙이다

- 스위치라는 네트워크 장비를 사용하면 충돌이 일어나지 않는다

### 정리

- 이더넷은 랜에서 데이터를 정상으로 주고받기 위한 규칙이다
- 이더넷은 데이터 충돌을 막기 위한 규칙으로 CSMA/CD 방식을 사용한다

## LESSON 13 MAC 주소의 구조

랜 카드를 제조할 때 정해지는 물리적인 주소에 대해 알아보자

랜카드는 비트열(0과 1)을 전기 신호로 변환한다. 이러한 랜 카드에는 `MAC 주소`라는 번호가 정해져 있다. 제조할 때 새겨지기 때문에 `물리 주소` 라고 부른다. 전 세계에서 유일한 번호로 할당되어 있다

> MAC 주소?
Media Access Control Address(물리 주소)
> 

MAC 주소는 48비트 숫자로 구성되어 있다. 그 중 앞쪽 24비트는 랜 카드를 만든 제조사 번호고 뒤쪽 24비트는 제조사가 랜 카드에 붙인 일련번호이다

OSI 모델이나 TCP/IP 모델 각 계층에서 헤더를 붙이는데 OSI 모델에서는 데이터 링크 계층에 해당하고, TCP/IP 모텔에서는 네트워크 계층에 해당한다. 이 계층에서 이더넷 헤더와 트레일러를 붙인다

- 이더넷 헤더는 목적지의 MAC 주소(6바이트), 출발지 MAC 주소(6바이트), 유형(2바이트) 이렇게 총 14바이트로 구성되어 있다
- 이더넷 유형?
    - 이더넷으로 전송되는 상위 계층 프로토콜의 종류
    - 프로토콜을 식별하는 16진수 번호가 들어간다
    - 유형 번호를 기억할 필요는 없지만 유형에 프로토콜 종류를 식별하는 번호가 들어간다는 내용은 기억해야함
- 트레일러?
    - FCS(Frame Check Sequence)라고도 한다.
    - 데이터 전송 도중 오류가 발생하는지 확인하는 용도로 사용한다
- 프레임
    - 이더넷 헤더와 트레일러가 추가된 데이터
    - 네트워크를 통해 프레임이 전송된다

컴퓨터 1에서 이더넷 헤더에 데이터의 목적지인 컴퓨터 3의 MAC 주소(목적지 MAC 주소)와 자신의 MAC 주소(출발지 MAC 주소) 정보를 넣고 데이터를 전송하면 캡슐화가 일어난다.

데이터 링크 계층에서 데이터에 이더넷 헤더와 트레일러를 추가하여 프레임을 만들고, 물리 계층에서 이 프레임 비트열을 전기 신호로 변환하여 네트워크를 통해 전송한다

허브에선 송신 컴퓨터에서 보낸 데이터를 모든 컴퓨터에 전송하지만 목적지 컴퓨터가 아닌 컴퓨터들은 MAC 주소가 다르기 때문에 데이터를 파기한다

자신의 MAC 주소가 송신 컴퓨터에서 보낸 데이터의 목적지 MAC 주소와 같은 컴퓨터는 데이터를 수신한다. 그 후 물리 계층에서 전기 신호로 전송된 데이터를 비트열로 변화하고 데이터 링크 계층에서 이더넷 헤더와 트레일러를 분리한다 → 역 캡슐화

만약 컴퓨터 1,2가 동시에 컴퓨터 3에 데이터를 전송하는 경우에는 충돌을 방지하기 위해 CSMA/CD 방식을 사용한다. 여기서 충돌이 감지되면 컴퓨터 2는 잠시 대기하고 데이터를 다시 전송한다

이더넷도 네트워크에서 발생할 수 있는 문제를 확실하게 고려한 규격이 있다

## LESSON 14 스위치의 구조

스위치는 허브와 달리 데이터 충돌이 발생하지 않는다.

### MAC 주소 테이블이란?

스위치는 데이터 링크 계층에서 동작하고 레이어 2 스위치 또는 스위칭 허브라고도 부르고 외형은 허브와 비슷하다

스위치 내부에는 MAC 주소 테이블이 있다. MAC 주소 테이블은 스위치의 포트 번호와 해당 포트에 연결되어 있는 컴퓨터의 MAC 주소가 등록되는 데이터베이스이다

> MAC 주소 테이블?
브리지 테이블이라고도 한다
> 

스위치의 전원을 켠 상태에서는 아직 MAC 주소 테이블에 아무것도 등록되어 있지 않지만 컴퓨터에서 목적지 MAC 주소가 추가된 프레임이라는 데이터가 전송되는 MAC 주소 테이블을 확인하고 출발지 MAC 주소가 등록되어 있지 않으면 MAC 주소를 포트와 함께 등록한다.

이를 `MAC 주소 학습 기능`이라고 한다

이것은 허브(더미 허브)에는 없는 기능이다

하지만 컴퓨터 1에서 컴퓨터 3에 데이터를 전송한 시점에서는 아직 컴퓨터 3의 목적지 MAC 주소가 MAC 주소 테이블에 등록되어 있지 않아서 송신 포트 이외의 포트인 다른 포트에서 데이터(프레임)가 전송되는데 이러한 데이터(프레임) 전송을 `플러딩(flodding, 홍수)`이라고 부른다

만약 MAC 주소 테이블에 목적지 MAC 주소가 등록되어 있었다면 1에서 3으로 보낼때 3에만 데이터가 전송된다

MAC 주소를 기준으로 목적지를 선택하는 것을 `MAC 주소 필터링`이라고 한다. 이것으로 불필요한 데이터를 네트워크에 전송하지 않게 된다

만약 주소가 등록되어 있지 않다면 목적지를 알 수 없기 때문에 플러딩이 일어나고 스위치에 등록되어 있지 않아 데이터가 다시 모든 컴퓨터에 보내진다(송신 컴퓨터 제외)

### 정리

- 스위치는 데이터 링크 계층에서 동작하며, 레이어 2 스위치 또는 스위칭 허브라고도 부른다
- 스위치에는 MAC 주소 테이블이 있다
- MAC 주소 테이블은 스위치의 포트 번호와 그 포트에 연결되어 있는 컴퓨터의 MAC 주소가 등록되는 데이터베이스다
- 스위치가 수신 포트 이외의 모든 포트에서 데이터를 송신하는 것을 플러딩이라고 한다
- 스위치에서 MAC 주소를 기준으로 출발지를 선택하는 것을 MAC 주소 필터링이라고 한다

## LESSON 15 데이터가 케이블에서 충돌하지 않는 구조

### 전이중 통신과 반이중 통신

- 전이중 통신
    - 데이터의 송수신을 동시에 통신하는 방식
- 반이중 통신
    - 회선 하나로 송신과 수신을 번갈아가면서 통신하는 방식

전이중 통신 방식은 데이터를 동시에 전송해도 충돌이 발생하지 않지만 반이중 통신은 데이터를 동시에 전송하면 충돌이 발생한다

허브 내부에는 송수신이 나누어져 있지 않기 때문에 허브(더미 허브)로 연결하면 동시에 데이터를 보낼 때 충돌이 일어난다. 이처럼 허브를 사용하면 회선 하나를 송신과 수신이 번갈아가면서 사용하면 반이중 통신 방식을 사용하게 된다

스위치는 충돌이 일어나지 않는 구조로 되어있기 때문에 전이중 통신 방식으로도 데이터를 주고 받을 수 있다. 허브를 사용하면 충돌이 생기면서 네트워크 지연이 발생하기 때문에 최근에는 네트워크로 스위치를 사용하는 것이 표준이다

스위치는 전송하는 동시에 수신도 가능해서 효율이 높다

허브 -  반이중 통신 방식

스위치 - 전이중 통신 방식 (효율이 좋음)

### 충돌 도메인이란?

충돌이 발생할 때 그 영향이 미치는 범위를 충돌 도메인이라고 한다

허브는 연결되어 있는 컴퓨터 전체가 하나의 충돌 도메인이 된다

스위치는 데이터를 동시에 송수신할 수 있는 전이중 통신 방식이기 때문에 충돌이 일어나지 않고 충돌 도메인의 범위도 좁다. 접속되어 있는 모든 컴퓨터에 영향을 미치지 않는다